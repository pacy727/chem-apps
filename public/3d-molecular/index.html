<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å­3Dãƒ“ãƒ¥ãƒ¼ã‚¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .sidebar h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .molecule-section {
            margin-bottom: 30px;
        }

        .molecule-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }

        .molecule-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .molecule-btn {
            padding: 10px 8px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .molecule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .molecule-btn.active {
            background: linear-gradient(45deg, #FF6B6B, #FF5252);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .molecule-btn.active:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .rotation-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #9C27B0, #E91E63);
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(156, 39, 176, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
        }

        .rotation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        .rotation-btn.paused {
            background: linear-gradient(45deg, #FF9800, #FF5722);
            box-shadow: 0 3px 10px rgba(255, 152, 0, 0.3);
        }

        .rotation-btn.paused:hover {
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        .legend {
            margin-top: 20px;
        }

        .legend h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #333;
            flex-shrink: 0;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }

        .viewer-container {
            flex: 1;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: #000;
            min-height: 400px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4CAF50;
            max-height: 200px;
        }

        .info-panel h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .info-panel p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .instructions {
            text-align: center;
            color: #666;
            font-size: 14px;
            font-style: italic;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
                overflow: auto;
            }

            .sidebar {
                width: 100%;
                max-height: none;
                order: 2;
            }

            .main-content {
                order: 1;
                min-height: 70vh;
            }

            .molecule-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>ğŸ§ª åˆ†å­é¸æŠ</h1>
        
        <div class="molecule-section">
            <h3>åŸºæœ¬åˆ†å­</h3>
            <div class="molecule-grid">
                <button class="molecule-btn active" onclick="showMolecule('H2O', this)">Hâ‚‚O</button>
                <button class="molecule-btn" onclick="showMolecule('CO2', this)">COâ‚‚</button>
                <button class="molecule-btn" onclick="showMolecule('NH3', this)">NHâ‚ƒ</button>
                <button class="molecule-btn" onclick="showMolecule('CH4', this)">CHâ‚„</button>
                <button class="molecule-btn" onclick="showMolecule('HCN', this)">HCN</button>
                <button class="molecule-btn" onclick="showMolecule('H2S', this)">Hâ‚‚S</button>
                <button class="molecule-btn" onclick="showMolecule('BH3', this)">BHâ‚ƒ</button>
                <button class="molecule-btn" onclick="showMolecule('SiH4', this)">SiHâ‚„</button>
                <button class="molecule-btn" onclick="showMolecule('HF', this)">HF</button>
                <button class="molecule-btn" onclick="showMolecule('HCl', this)">HCl</button>
                <button class="molecule-btn" onclick="showMolecule('H2', this)">Hâ‚‚</button>
                <button class="molecule-btn" onclick="showMolecule('O2', this)">Oâ‚‚</button>
                <button class="molecule-btn" onclick="showMolecule('N2', this)">Nâ‚‚</button>
            </div>
        </div>

        <div class="molecule-section">
            <h3>ã‚¤ã‚ªãƒ³</h3>
            <div class="molecule-grid">
                <button class="molecule-btn" onclick="showMolecule('NH4', this)">NHâ‚„âº</button>
                <button class="molecule-btn" onclick="showMolecule('H3O', this)">Hâ‚ƒOâº</button>
            </div>
        </div>

        <div class="molecule-section">
            <h3>æœ‰æ©ŸåŒ–åˆç‰©</h3>
            <div class="molecule-grid">
                <button class="molecule-btn" onclick="showMolecule('C2H6', this)">Câ‚‚Hâ‚†</button>
                <button class="molecule-btn" onclick="showMolecule('C2H4', this)">Câ‚‚Hâ‚„</button>
                <button class="molecule-btn" onclick="showMolecule('C2H2', this)">Câ‚‚Hâ‚‚</button>
                <button class="molecule-btn" onclick="showMolecule('CH2O', this)">CHâ‚‚O</button>
            </div>
        </div>

        <div class="controls">
            <button class="rotation-btn" id="rotationBtn" onclick="toggleRotation()">â¸ï¸ å›è»¢åœæ­¢</button>
        </div>

        <div class="legend">
            <h4>å…ƒç´ ã®è‰²</h4>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff4444;"></div>
                    <span>é…¸ç´  (O)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffffff;"></div>
                    <span>æ°´ç´  (H)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #444444;"></div>
                    <span>ç‚­ç´  (C)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4444ff;"></div>
                    <span>çª’ç´  (N)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffcc00;"></div>
                    <span>ç¡«é»„ (S)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff88cc;"></div>
                    <span>ãƒ›ã‚¦ç´  (B)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #888888;"></div>
                    <span>ã‚±ã‚¤ç´  (Si)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #90ee90;"></div>
                    <span>ãƒ•ãƒƒç´  (F)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #00ff88;"></div>
                    <span>å¡©ç´  (Cl)</span>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="viewer-container" id="viewer"></div>

        <div class="info-panel" id="info-panel">
            <h3 id="molecule-name">Hâ‚‚O (æ°´)</h3>
            <p id="molecule-description">æ°´åˆ†å­ã¯é…¸ç´ åŸå­1å€‹ã¨æ°´ç´ åŸå­2å€‹ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚åˆ†å­ã®å½¢çŠ¶ã¯æ›²ãŒã£ãŸï¼ˆå±ˆæ›²ï¼‰å½¢ã‚’ã—ã¦ãŠã‚Šã€çµåˆè§’ã¯ç´„104.5Â°ã§ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘é…¸ç´ ã®é›»æ°—é™°æ€§åº¦ãŒé«˜ã„ãŸã‚ã€O-HçµåˆãŒæ¥µæ€§ã‚’æŒã¡ã€åˆ†å­å…¨ä½“ã¨ã—ã¦æ¥µæ€§ã‚’æŒã¡ã¾ã™ã€‚</p>
        </div>

        <div class="instructions">
            ğŸ’¡ ãƒã‚¦ã‚¹ã§ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦å›è»¢ã€ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ ã§ãã¾ã™
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, controls;
        let currentMolecule = null;
        let isRotating = true;

        // åˆ†å­ãƒ‡ãƒ¼ã‚¿
        const molecules = {
            H2O: {
                name: "Hâ‚‚O (æ°´)",
                description: "æ°´åˆ†å­ã¯é…¸ç´ åŸå­1å€‹ã¨æ°´ç´ åŸå­2å€‹ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚åˆ†å­ã®å½¢çŠ¶ã¯æ›²ãŒã£ãŸï¼ˆå±ˆæ›²ï¼‰å½¢ã‚’ã—ã¦ãŠã‚Šã€çµåˆè§’ã¯ç´„104.5Â°ã§ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘é…¸ç´ ã®é›»æ°—é™°æ€§åº¦ãŒé«˜ã„ãŸã‚ã€O-HçµåˆãŒæ¥µæ€§ã‚’æŒã¡ã€åˆ†å­å…¨ä½“ã¨ã—ã¦æ¥µæ€§ã‚’æŒã¡ã¾ã™ã€‚",
                atoms: [
                    { element: 'O', position: [0, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'H', position: [0.96, 0.25, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.24, 0.97, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 }
                ]
            },
            CO2: {
                name: "COâ‚‚ (äºŒé…¸åŒ–ç‚­ç´ )",
                description: "äºŒé…¸åŒ–ç‚­ç´ åˆ†å­ã¯ç‚­ç´ åŸå­1å€‹ã¨é…¸ç´ åŸå­2å€‹ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ç›´ç·šå‹ã®åˆ†å­ã§ã€ç‚­ç´ åŸå­ãŒä¸­å¿ƒã«ä½ç½®ã—ã€ä¸¡å´ã«é…¸ç´ åŸå­ãŒé…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚C=OäºŒé‡çµåˆã‚’æŒã¡ã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘C=Oçµåˆã¯æ¥µæ€§ã§ã™ãŒã€ç›´ç·šå‹æ§‹é€ ã«ã‚ˆã‚Šæ¥µæ€§ãŒæ‰“ã¡æ¶ˆã—åˆã„ã¾ã™ã€‚",
                atoms: [
                    { element: 'C', position: [0, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'O', position: [1.2, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'O', position: [-1.2, 0, 0], color: 0xff4444, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2, type: 'double' }
                ]
            },
            NH3: {
                name: "NHâ‚ƒ (ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢)",
                description: "ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢åˆ†å­ã¯çª’ç´ åŸå­1å€‹ã¨æ°´ç´ åŸå­3å€‹ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸‰è§’éŒã®å½¢çŠ¶ã‚’ã—ã¦ãŠã‚Šã€çª’ç´ åŸå­ãŒé ‚ç‚¹ã«ä½ç½®ã—ã€3ã¤ã®æ°´ç´ åŸå­ãŒåº•é¢ã‚’å½¢æˆã—ã¦ã„ã¾ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘çª’ç´ ã®é›»æ°—é™°æ€§åº¦ãŒé«˜ãã€éçµåˆé›»å­å¯¾ã«ã‚ˆã‚Šåˆ†å­ãŒéå¯¾ç§°ã¨ãªã‚‹ãŸã‚æ¥µæ€§ã‚’æŒã¡ã¾ã™ã€‚",
                atoms: [
                    { element: 'N', position: [0, 0, 0], color: 0x4444ff, radius: 0.5 },
                    { element: 'H', position: [0.94, -0.54, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, 0.82], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, -0.82], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            },
            CH4: {
                name: "CHâ‚„ (ãƒ¡ã‚¿ãƒ³)",
                description: "ãƒ¡ã‚¿ãƒ³åˆ†å­ã¯ç‚­ç´ åŸå­1å€‹ã¨æ°´ç´ åŸå­4å€‹ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚æ­£å››é¢ä½“ã®å½¢çŠ¶ã‚’ã—ã¦ãŠã‚Šã€ç‚­ç´ åŸå­ãŒä¸­å¿ƒã«ä½ç½®ã—ã€4ã¤ã®æ°´ç´ åŸå­ãŒç­‰ã—ã„è§’åº¦ã§é…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘C-Hçµåˆã®æ¥µæ€§ã¯å°ã•ãã€æ­£å››é¢ä½“æ§‹é€ ã«ã‚ˆã‚Šå¯¾ç§°æ€§ãŒé«˜ã„ãŸã‚ç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'C', position: [0, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [0.63, 0.63, 0.63], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.63, -0.63, 0.63], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.63, 0.63, -0.63], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.63, -0.63, -0.63], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 }
                ]
            },
            HCN: {
                name: "HCN (ã‚·ã‚¢ãƒ³åŒ–æ°´ç´ )",
                description: "ã‚·ã‚¢ãƒ³åŒ–æ°´ç´ ã¯ç›´ç·šå‹åˆ†å­ã§ã€ç‚­ç´ ã¨çª’ç´ ã®é–“ã«ä¸‰é‡çµåˆãŒã‚ã‚Šã¾ã™ã€‚æ¥µã‚ã¦æ¯’æ€§ãŒå¼·ã„åˆ†å­ã§ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘Câ‰¡Nçµåˆã¨C-Hçµåˆã®æ¥µæ€§ã«ã‚ˆã‚Šã€åˆ†å­å…¨ä½“ã¨ã—ã¦æ¥µæ€§ã‚’æŒã¡ã¾ã™ã€‚",
                atoms: [
                    { element: 'H', position: [-1.7, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'C', position: [-0.5, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'N', position: [0.7, 0, 0], color: 0x4444ff, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 1, to: 2, type: 'triple' }
                ]
            },
            H2S: {
                name: "Hâ‚‚S (ç¡«åŒ–æ°´ç´ )",
                description: "ç¡«åŒ–æ°´ç´ ã¯æ°´åˆ†å­ã¨ä¼¼ãŸå±ˆæ›²æ§‹é€ ã‚’æŒã¡ã¾ã™ãŒã€çµåˆè§’ãŒã‚ˆã‚Šå°ã•ããªã£ã¦ã„ã¾ã™ã€‚è…ã£ãŸåµã®ã«ãŠã„ãŒã—ã¾ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘ç¡«é»„ã®é›»æ°—é™°æ€§åº¦ã«ã‚ˆã‚Š S-HçµåˆãŒæ¥µæ€§ã‚’æŒã¡ã€å±ˆæ›²æ§‹é€ ã®ãŸã‚åˆ†å­å…¨ä½“ã¨ã—ã¦æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'S', position: [0, 0, 0], color: 0xffcc00, radius: 0.6 },
                    { element: 'H', position: [1.0, 0.2, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.2, 1.0, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 }
                ]
            },
            BH3: {
                name: "BHâ‚ƒ (ãƒœãƒ©ãƒ³)",
                description: "ãƒœãƒ©ãƒ³ã¯å¹³é¢ä¸‰è§’å½¢æ§‹é€ ã‚’æŒã¤åˆ†å­ã§ã™ã€‚ãƒ›ã‚¦ç´ åŸå­ã¯é›»å­ä¸è¶³ã§ã€ä»–ã®åˆ†å­ã¨çµåˆã—ã‚„ã™ã„æ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘B-Hçµåˆã®æ¥µæ€§ã¯å°ã•ãã€å¹³é¢ä¸‰è§’å½¢ã®å¯¾ç§°æ§‹é€ ã«ã‚ˆã‚Šç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'B', position: [0, 0, 0], color: 0xff88cc, radius: 0.5 },
                    { element: 'H', position: [1.0, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.5, 0.87, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.5, -0.87, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            },
            SiH4: {
                name: "SiHâ‚„ (ã‚·ãƒ©ãƒ³)",
                description: "ã‚·ãƒ©ãƒ³ã¯ãƒ¡ã‚¿ãƒ³ã¨åŒã˜æ­£å››é¢ä½“æ§‹é€ ã‚’æŒã¡ã¾ã™ã€‚ã‚±ã‚¤ç´ ãŒãƒ¡ã‚¿ãƒ³ã®ç‚­ç´ ã®ä½ç½®ã«ã‚ã‚Šã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘Si-Hçµåˆã®æ¥µæ€§ã¯å°ã•ãã€æ­£å››é¢ä½“ã®å¯¾ç§°æ§‹é€ ã«ã‚ˆã‚Šç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'Si', position: [0, 0, 0], color: 0x888888, radius: 0.6 },
                    { element: 'H', position: [0.7, 0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, -0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, 0.7, -0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.7, -0.7, -0.7], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 }
                ]
            },
            HF: {
                name: "HF (ãƒ•ãƒƒåŒ–æ°´ç´ )",
                description: "ãƒ•ãƒƒåŒ–æ°´ç´ ã¯æœ€ã‚‚å˜ç´”ãªäºŒåŸå­åˆ†å­ã®ä¸€ã¤ã§ã™ã€‚ãƒ•ãƒƒç´ ã¯é›»æ°—é™°æ€§åº¦ãŒæœ€ã‚‚é«˜ã„å…ƒç´ ã§ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘H-Fçµåˆã¯éå¸¸ã«å¤§ããªæ¥µæ€§ã‚’æŒã¡ã€å¼·ã„æ¥µæ€§ã‚’ç¤ºã—ã¾ã™ã€‚",
                atoms: [
                    { element: 'H', position: [-0.6, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'F', position: [0.6, 0, 0], color: 0x90ee90, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1 }
                ]
            },
            HCl: {
                name: "HCl (å¡©åŒ–æ°´ç´ )",
                description: "å¡©åŒ–æ°´ç´ ã¯å¡©é…¸ã®åŸæ–™ã¨ãªã‚‹åˆ†å­ã§ã™ã€‚æ°´ã«æº¶ã‘ã‚‹ã¨å¼·é…¸æ€§ã‚’ç¤ºã—ã¾ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘å¡©ç´ ã®é›»æ°—é™°æ€§åº¦ã«ã‚ˆã‚Š H-ClçµåˆãŒå¤§ããªæ¥µæ€§ã‚’æŒã¡ã¾ã™ã€‚",
                atoms: [
                    { element: 'H', position: [-0.8, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'Cl', position: [0.8, 0, 0], color: 0x00ff88, radius: 0.6 }
                ],
                bonds: [
                    { from: 0, to: 1 }
                ]
            },
            H2: {
                name: "Hâ‚‚ (æ°´ç´ åˆ†å­)",
                description: "æ°´ç´ åˆ†å­ã¯æœ€ã‚‚å˜ç´”ãªåˆ†å­ã§ã€2ã¤ã®æ°´ç´ åŸå­ãŒå…±æœ‰çµåˆã§çµã°ã‚Œã¦ã„ã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘åŒã˜åŸå­åŒå£«ã®çµåˆã®ãŸã‚ã€å®Œå…¨ã«ç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'H', position: [-0.4, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.4, 0, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 }
                ]
            },
            O2: {
                name: "Oâ‚‚ (é…¸ç´ åˆ†å­)",
                description: "é…¸ç´ åˆ†å­ã¯2ã¤ã®é…¸ç´ åŸå­ãŒäºŒé‡çµåˆã§çµã°ã‚Œã¦ã„ã¾ã™ã€‚ç”Ÿå‘½ã«ä¸å¯æ¬ ãªåˆ†å­ã§ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘åŒã˜åŸå­åŒå£«ã®çµåˆã®ãŸã‚ã€å®Œå…¨ã«ç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'O', position: [-0.6, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'O', position: [0.6, 0, 0], color: 0xff4444, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' }
                ]
            },
            N2: {
                name: "Nâ‚‚ (çª’ç´ åˆ†å­)",
                description: "çª’ç´ åˆ†å­ã¯2ã¤ã®çª’ç´ åŸå­ãŒä¸‰é‡çµåˆã§çµã°ã‚Œã¦ãŠã‚Šã€éå¸¸ã«å®‰å®šãªåˆ†å­ã§ã™ã€‚å¤§æ°—ã®ç´„78%ã‚’å ã‚ã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘åŒã˜åŸå­åŒå£«ã®çµåˆã®ãŸã‚ã€å®Œå…¨ã«ç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'N', position: [-0.55, 0, 0], color: 0x4444ff, radius: 0.5 },
                    { element: 'N', position: [0.55, 0, 0], color: 0x4444ff, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'triple' }
                ]
            },
            NH4: {
                name: "NHâ‚„âº (ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚¤ã‚ªãƒ³)",
                description: "ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¦ãƒ ã‚¤ã‚ªãƒ³ã¯æ­£å››é¢ä½“æ§‹é€ ã‚’æŒã¤é™½ã‚¤ã‚ªãƒ³ã§ã™ã€‚ã‚¢ãƒ³ãƒ¢ãƒ‹ã‚¢ãŒæ°´ç´ ã‚¤ã‚ªãƒ³ã‚’å—ã‘å–ã£ã¦å½¢æˆã•ã‚Œã¾ã™ã€‚ã€ç„¡æ¥µæ€§ã‚¤ã‚ªãƒ³ã€‘æ­£å››é¢ä½“ã®å¯¾ç§°æ§‹é€ ã«ã‚ˆã‚Šã€ã‚¤ã‚ªãƒ³å†…ã§ã®é›»è·åˆ†å¸ƒã¯å‡ç­‰ã§ã™ã€‚",
                atoms: [
                    { element: 'N', position: [0, 0, 0], color: 0x4444ff, radius: 0.5 },
                    { element: 'H', position: [0.7, 0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, -0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, 0.7, -0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.7, -0.7, -0.7], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 }
                ]
            },
            H3O: {
                name: "Hâ‚ƒOâº (ã‚ªã‚­ã‚½ãƒ‹ã‚¦ãƒ ã‚¤ã‚ªãƒ³)",
                description: "ã‚ªã‚­ã‚½ãƒ‹ã‚¦ãƒ ã‚¤ã‚ªãƒ³ã¯ä¸‰è§’éŒæ§‹é€ ã‚’æŒã¤é™½ã‚¤ã‚ªãƒ³ã§ã™ã€‚æ°´åˆ†å­ãŒæ°´ç´ ã‚¤ã‚ªãƒ³ã‚’å—ã‘å–ã£ã¦å½¢æˆã•ã‚Œã¾ã™ã€‚ã€æ¥µæ€§ã‚¤ã‚ªãƒ³ã€‘ä¸‰è§’éŒæ§‹é€ ã«ã‚ˆã‚Šã€ã‚¤ã‚ªãƒ³å†…ã§ã®é›»è·åˆ†å¸ƒã«åã‚ŠãŒã‚ã‚Šã¾ã™ã€‚",
                atoms: [
                    { element: 'O', position: [0, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'H', position: [0.94, -0.54, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, 0.82], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, -0.82], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            },
            C2H6: {
                name: "Câ‚‚Hâ‚† (ã‚¨ã‚¿ãƒ³)",
                description: "ã‚¨ã‚¿ãƒ³ã¯2ã¤ã®ç‚­ç´ åŸå­ãŒå˜çµåˆã§çµã°ã‚ŒãŸã‚¢ãƒ«ã‚«ãƒ³ã§ã™ã€‚å„ç‚­ç´ ã¯æ­£å››é¢ä½“æ§‹é€ ã‚’æŒã¡ã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘C-Cçµåˆã¨C-Hçµåˆã®æ¥µæ€§ã¯å°ã•ãã€åˆ†å­å…¨ä½“ã¨ã—ã¦å¯¾ç§°æ€§ãŒé«˜ã„ãŸã‚ç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'C', position: [-0.8, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'C', position: [0.8, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [-1.3, 0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-1.3, -0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-1.3, 0, -1.0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.3, 0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.3, -0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.3, 0, -1.0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 },
                    { from: 1, to: 5 },
                    { from: 1, to: 6 },
                    { from: 1, to: 7 }
                ]
            },
            C2H4: {
                name: "Câ‚‚Hâ‚„ (ã‚¨ãƒãƒ¬ãƒ³)",
                description: "ã‚¨ãƒãƒ¬ãƒ³ã¯2ã¤ã®ç‚­ç´ åŸå­ãŒäºŒé‡çµåˆã§çµã°ã‚ŒãŸã‚¢ãƒ«ã‚±ãƒ³ã§ã™ã€‚å¹³é¢åˆ†å­ã§ã€é‡è¦ãªåŒ–å­¦åŸæ–™ã§ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘C=Cçµåˆã¨C-Hçµåˆã®æ¥µæ€§ã¯å°ã•ãã€å¹³é¢æ§‹é€ ã®å¯¾ç§°æ€§ã«ã‚ˆã‚Šç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'C', position: [-0.7, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'C', position: [0.7, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [-1.2, 0.9, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-1.2, -0.9, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.2, 0.9, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.2, -0.9, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 1, to: 4 },
                    { from: 1, to: 5 }
                ]
            },
            C2H2: {
                name: "Câ‚‚Hâ‚‚ (ã‚¢ã‚»ãƒãƒ¬ãƒ³)",
                description: "ã‚¢ã‚»ãƒãƒ¬ãƒ³ã¯2ã¤ã®ç‚­ç´ åŸå­ãŒä¸‰é‡çµåˆã§çµã°ã‚ŒãŸç›´ç·šå‹åˆ†å­ã§ã™ã€‚æº¶æ¥ãªã©ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã€ç„¡æ¥µæ€§åˆ†å­ã€‘Câ‰¡Cçµåˆã¨C-Hçµåˆã®æ¥µæ€§ã¯å°ã•ãã€ç›´ç·šæ§‹é€ ã®å¯¾ç§°æ€§ã«ã‚ˆã‚Šç„¡æ¥µæ€§ã§ã™ã€‚",
                atoms: [
                    { element: 'H', position: [-1.7, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'C', position: [-0.6, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'C', position: [0.6, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [1.7, 0, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 1, to: 2, type: 'triple' },
                    { from: 2, to: 3 }
                ]
            },
            CH2O: {
                name: "CHâ‚‚O (ãƒ›ãƒ«ãƒ ã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰)",
                description: "ãƒ›ãƒ«ãƒ ã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰ã¯å¹³é¢ä¸‰è§’å½¢æ§‹é€ ã‚’æŒã¤ã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰ã§ã™ã€‚C=OäºŒé‡çµåˆã‚’æŒã¡ã¾ã™ã€‚ã€æ¥µæ€§åˆ†å­ã€‘C=Oçµåˆã®å¼·ã„æ¥µæ€§ã«ã‚ˆã‚Šã€åˆ†å­å…¨ä½“ã¨ã—ã¦å¤§ããªæ¥µæ€§ã‚’æŒã¡ã¾ã™ã€‚",
                atoms: [
                    { element: 'C', position: [0, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'O', position: [0, 1.2, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'H', position: [-0.9, -0.6, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.9, -0.6, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            }
        };

        // OrbitControlsã‚’æ‰‹å‹•å®Ÿè£…ï¼ˆã‚ºãƒ¼ãƒ æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ï¼‰
        class OrbitControls {
            constructor(camera, domElement) {
                this.camera = camera;
                this.domElement = domElement;
                this.enabled = true;
                this.enableDamping = true;
                this.dampingFactor = 0.25;
                this.enableZoom = true;  // ã‚ºãƒ¼ãƒ æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
                this.enableRotate = true;
                this.enablePan = false;

                this.minDistance = 3;
                this.maxDistance = 15;

                this.spherical = { radius: 8, phi: Math.PI / 3, theta: 0 };
                this.sphericalDelta = { radius: 0, phi: 0, theta: 0 };

                this.rotateStart = { x: 0, y: 0 };
                this.rotateEnd = { x: 0, y: 0 };
                this.rotateDelta = { x: 0, y: 0 };

                this.isRotating = false;

                this.setupEventListeners();
                this.update();
            }

            setupEventListeners() {
                this.domElement.addEventListener('mousedown', this.onMouseDown.bind(this));
                this.domElement.addEventListener('wheel', this.onMouseWheel.bind(this), { passive: false });
                this.domElement.addEventListener('contextmenu', (e) => e.preventDefault());
            }

            onMouseDown(event) {
                if (!this.enabled || !this.enableRotate) return;
                
                event.preventDefault();
                this.isRotating = true;

                this.rotateStart.x = event.clientX;
                this.rotateStart.y = event.clientY;

                document.addEventListener('mousemove', this.onMouseMove.bind(this));
                document.addEventListener('mouseup', this.onMouseUp.bind(this));
            }

            onMouseMove(event) {
                if (!this.isRotating) return;

                this.rotateEnd.x = event.clientX;
                this.rotateEnd.y = event.clientY;

                this.rotateDelta.x = this.rotateEnd.x - this.rotateStart.x;
                this.rotateDelta.y = this.rotateEnd.y - this.rotateStart.y;

                this.sphericalDelta.theta -= 2 * Math.PI * this.rotateDelta.x / this.domElement.clientWidth;
                this.sphericalDelta.phi -= 2 * Math.PI * this.rotateDelta.y / this.domElement.clientHeight;

                this.rotateStart.x = this.rotateEnd.x;
                this.rotateStart.y = this.rotateEnd.y;

                this.update();
            }

            onMouseUp() {
                this.isRotating = false;
                document.removeEventListener('mousemove', this.onMouseMove);
                document.removeEventListener('mouseup', this.onMouseUp);
            }

            onMouseWheel(event) {
                if (!this.enabled || !this.enableZoom) return;
                
                event.preventDefault();
                
                // ã‚ºãƒ¼ãƒ é€Ÿåº¦ã‚’èª¿æ•´
                const zoomSpeed = 0.1;
                
                if (event.deltaY < 0) {
                    // ã‚ºãƒ¼ãƒ ã‚¤ãƒ³
                    this.spherical.radius *= (1 - zoomSpeed);
                } else {
                    // ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ
                    this.spherical.radius *= (1 + zoomSpeed);
                }

                // è·é›¢åˆ¶é™ã‚’é©ç”¨
                this.spherical.radius = Math.max(this.minDistance, Math.min(this.maxDistance, this.spherical.radius));

                this.update();
            }

            update() {
                this.spherical.radius += this.sphericalDelta.radius;
                this.spherical.theta += this.sphericalDelta.theta;
                this.spherical.phi += this.sphericalDelta.phi;

                this.spherical.radius = Math.max(this.minDistance, Math.min(this.maxDistance, this.spherical.radius));
                this.spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, this.spherical.phi));

                const x = this.spherical.radius * Math.sin(this.spherical.phi) * Math.cos(this.spherical.theta);
                const y = this.spherical.radius * Math.cos(this.spherical.phi);
                const z = this.spherical.radius * Math.sin(this.spherical.phi) * Math.sin(this.spherical.theta);

                this.camera.position.set(x, y, z);
                this.camera.lookAt(0, 0, 0);

                if (this.enableDamping) {
                    this.sphericalDelta.radius *= (1 - this.dampingFactor);
                    this.sphericalDelta.theta *= (1 - this.dampingFactor);
                    this.sphericalDelta.phi *= (1 - this.dampingFactor);
                } else {
                    this.sphericalDelta.radius = 0;
                    this.sphericalDelta.theta = 0;
                    this.sphericalDelta.phi = 0;
                }
            }
        }

        // åˆæœŸåŒ–
        function init() {
            const viewer = document.getElementById('viewer');
            
            // ã‚·ãƒ¼ãƒ³ä½œæˆ
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            // ã‚«ãƒ¡ãƒ©ä½œæˆ
            camera = new THREE.PerspectiveCamera(75, viewer.clientWidth / viewer.clientHeight, 0.1, 1000);
            camera.position.set(5, 3, 5);

            // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ä½œæˆ
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(viewer.clientWidth, viewer.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            viewer.appendChild(renderer.domElement);

            // ãƒ©ã‚¤ãƒˆè¨­å®š
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¨­å®š
            controls = new OrbitControls(camera, renderer.domElement);

            // ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
            window.addEventListener('resize', onWindowResize, false);

            // åˆæœŸåˆ†å­è¡¨ç¤º
            showMolecule('H2O', document.querySelector('.molecule-btn.active'));

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—é–‹å§‹
            animate();
        }

        function onWindowResize() {
            const viewer = document.getElementById('viewer');
            camera.aspect = viewer.clientWidth / viewer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(viewer.clientWidth, viewer.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (currentMolecule && isRotating) {
                currentMolecule.rotation.y += 0.01;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        function clearScene() {
            while (scene.children.length > 0) {
                const child = scene.children[0];
                if (child.geometry) child.geometry.dispose();
                if (child.material) {
                    if (Array.isArray(child.material)) {
                        child.material.forEach(material => material.dispose());
                    } else {
                        child.material.dispose();
                    }
                }
                scene.remove(child);
            }

            // ãƒ©ã‚¤ãƒˆã‚’å†è¿½åŠ 
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
        }

        function showMolecule(moleculeKey, buttonElement) {
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
            if (!molecules[moleculeKey]) {
                console.error(`Molecule ${moleculeKey} not found`);
                return;
            }

            const molecule = molecules[moleculeKey];
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
            if (!molecule.atoms || !Array.isArray(molecule.atoms)) {
                console.error(`Invalid molecule data for ${moleculeKey}`);
                return;
            }

            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.molecule-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }

            // æƒ…å ±ãƒ‘ãƒãƒ«æ›´æ–°
            document.getElementById('molecule-name').textContent = molecule.name;
            document.getElementById('molecule-description').textContent = molecule.description;

            // ã‚·ãƒ¼ãƒ³ã‚¯ãƒªã‚¢
            clearScene();

            // åˆ†å­ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
            const moleculeGroup = new THREE.Group();

            // åŸå­ã‚’è¿½åŠ 
            molecule.atoms.forEach((atom, index) => {
                // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
                if (!atom.position || !Array.isArray(atom.position) || atom.position.length < 3) {
                    console.error(`Invalid atom position for atom ${index} in molecule ${moleculeKey}`);
                    return;
                }

                const geometry = new THREE.SphereGeometry(atom.radius || 0.5, 32, 32);
                const material = new THREE.MeshLambertMaterial({ 
                    color: atom.color || 0xffffff 
                });
                const atomMesh = new THREE.Mesh(geometry, material);
                atomMesh.position.set(atom.position[0], atom.position[1], atom.position[2]);
                atomMesh.castShadow = true;
                atomMesh.receiveShadow = true;
                moleculeGroup.add(atomMesh);
            });

            // çµåˆã‚’è¿½åŠ 
            if (molecule.bonds && Array.isArray(molecule.bonds)) {
                molecule.bonds.forEach(bond => {
                    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
                    if (bond.from >= molecule.atoms.length || bond.to >= molecule.atoms.length) {
                        console.error(`Invalid bond indices in molecule ${moleculeKey}`);
                        return;
                    }

                    const fromAtom = molecule.atoms[bond.from];
                    const toAtom = molecule.atoms[bond.to];
                    
                    if (!fromAtom.position || !toAtom.position) {
                        console.error(`Invalid atom positions for bond in molecule ${moleculeKey}`);
                        return;
                    }

                    const bondType = bond.type || 'single';
                    const bondCount = bondType === 'single' ? 1 : bondType === 'double' ? 2 : 3;

                    for (let i = 0; i < bondCount; i++) {
                        const geometry = new THREE.CylinderGeometry(0.05, 0.05, 1, 8);
                        const material = new THREE.MeshLambertMaterial({ color: 0xcccccc });
                        const bondMesh = new THREE.Mesh(geometry, material);

                        const start = new THREE.Vector3(fromAtom.position[0], fromAtom.position[1], fromAtom.position[2]);
                        const end = new THREE.Vector3(toAtom.position[0], toAtom.position[1], toAtom.position[2]);
                        const distance = start.distanceTo(end);

                        bondMesh.scale.y = distance;
                        bondMesh.position.copy(start.clone().add(end).multiplyScalar(0.5));

                        // if (bondCount > 1) {
                        //     const offset = (i - (bondCount - 1) / 2) * 0.15;
                        //     const perpendicular = new THREE.Vector3(0, 1, 0);
                        //     const direction = end.clone().sub(start).normalize();
                        //     const cross = perpendicular.cross(direction).normalize();
                        //     bondMesh.position.add(cross.multiplyScalar(offset));
                        // }

                        if (bondCount > 1) {
                            const offset = (i - (bondCount - 1) / 2) * 0.2;
                            const direction = end.clone().sub(start).normalize();
                            
                            // ã‚ˆã‚Šé©åˆ‡ãªå‚ç›´ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—
                            let perpendicular;
                            if (Math.abs(direction.y) < 0.9) {
                                perpendicular = new THREE.Vector3(0, 1, 0);
                            } else {
                                perpendicular = new THREE.Vector3(1, 0, 0);
                            }
                            
                            const cross = perpendicular.cross(direction).normalize();
                            bondMesh.position.add(cross.multiplyScalar(offset));
                        }

                        const direction = end.clone().sub(start);
                        bondMesh.lookAt(bondMesh.position.clone().add(direction));
                        bondMesh.rotateX(Math.PI / 2);

                        moleculeGroup.add(bondMesh);
                    }
                });
            }

            scene.add(moleculeGroup);
            currentMolecule = moleculeGroup;
        }

        function toggleRotation() {
            isRotating = !isRotating;
            const btn = document.getElementById('rotationBtn');
            if (isRotating) {
                btn.textContent = 'â¸ï¸ å›è»¢åœæ­¢';
                btn.classList.remove('paused');
            } else {
                btn.textContent = 'â–¶ï¸ å›è»¢é–‹å§‹';
                btn.classList.add('paused');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>