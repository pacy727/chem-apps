<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂàÜÂ≠ê3D„Éì„É•„Éº„Ç¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .sidebar h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .molecule-section {
            margin-bottom: 30px;
        }

        .molecule-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 5px;
        }

        .molecule-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .molecule-btn {
            padding: 10px 8px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .molecule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .molecule-btn.active {
            background: linear-gradient(45deg, #FF6B6B, #FF5252);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .molecule-btn.active:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .rotation-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #9C27B0, #E91E63);
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(156, 39, 176, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
        }

        .rotation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        .rotation-btn.paused {
            background: linear-gradient(45deg, #FF9800, #FF5722);
            box-shadow: 0 3px 10px rgba(255, 152, 0, 0.3);
        }

        .rotation-btn.paused:hover {
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        .legend {
            margin-top: 20px;
        }

        .legend h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #333;
            flex-shrink: 0;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }

        .viewer-container {
            flex: 1;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: #000;
            min-height: 400px;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4CAF50;
            max-height: 200px;
        }

        .info-panel h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .info-panel p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .instructions {
            text-align: center;
            color: #666;
            font-size: 14px;
            font-style: italic;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
                overflow: auto;
            }

            .sidebar {
                width: 100%;
                max-height: none;
                order: 2;
            }

            .main-content {
                order: 1;
                min-height: 70vh;
            }

            .molecule-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>üß™ ÂàÜÂ≠êÈÅ∏Êäû</h1>
        
        <div class="molecule-section">
            <h3>Âü∫Êú¨ÂàÜÂ≠ê</h3>
            <div class="molecule-grid">
                <button class="molecule-btn active" onclick="showMolecule('H2O', this)">H‚ÇÇO</button>
                <button class="molecule-btn" onclick="showMolecule('CO2', this)">CO‚ÇÇ</button>
                <button class="molecule-btn" onclick="showMolecule('NH3', this)">NH‚ÇÉ</button>
                <button class="molecule-btn" onclick="showMolecule('CH4', this)">CH‚ÇÑ</button>
                <button class="molecule-btn" onclick="showMolecule('HCN', this)">HCN</button>
                <button class="molecule-btn" onclick="showMolecule('H2S', this)">H‚ÇÇS</button>
                <button class="molecule-btn" onclick="showMolecule('BH3', this)">BH‚ÇÉ</button>
                <button class="molecule-btn" onclick="showMolecule('SiH4', this)">SiH‚ÇÑ</button>
                <button class="molecule-btn" onclick="showMolecule('HF', this)">HF</button>
                <button class="molecule-btn" onclick="showMolecule('HCl', this)">HCl</button>
                <button class="molecule-btn" onclick="showMolecule('H2', this)">H‚ÇÇ</button>
                <button class="molecule-btn" onclick="showMolecule('O2', this)">O‚ÇÇ</button>
                <button class="molecule-btn" onclick="showMolecule('N2', this)">N‚ÇÇ</button>
            </div>
        </div>

        <div class="molecule-section">
            <h3>„Ç§„Ç™„É≥</h3>
            <div class="molecule-grid">
                <button class="molecule-btn" onclick="showMolecule('NH4', this)">NH‚ÇÑ‚Å∫</button>
                <button class="molecule-btn" onclick="showMolecule('H3O', this)">H‚ÇÉO‚Å∫</button>
            </div>
        </div>

        <div class="molecule-section">
            <h3>ÊúâÊ©üÂåñÂêàÁâ©</h3>
            <div class="molecule-grid">
                <button class="molecule-btn" onclick="showMolecule('C2H6', this)">C‚ÇÇH‚ÇÜ</button>
                <button class="molecule-btn" onclick="showMolecule('C2H4', this)">C‚ÇÇH‚ÇÑ</button>
                <button class="molecule-btn" onclick="showMolecule('C2H2', this)">C‚ÇÇH‚ÇÇ</button>
                <button class="molecule-btn" onclick="showMolecule('CH2O', this)">CH‚ÇÇO</button>
            </div>
        </div>

        <div class="controls">
            <button class="rotation-btn" id="rotationBtn" onclick="toggleRotation()">‚è∏Ô∏è ÂõûËª¢ÂÅúÊ≠¢</button>
        </div>

        <div class="legend">
            <h4>ÂÖÉÁ¥†„ÅÆËâ≤</h4>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff4444;"></div>
                    <span>ÈÖ∏Á¥† (O)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffffff;"></div>
                    <span>Ê∞¥Á¥† (H)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #444444;"></div>
                    <span>ÁÇ≠Á¥† (C)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4444ff;"></div>
                    <span>Á™íÁ¥† (N)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffcc00;"></div>
                    <span>Á°´ÈªÑ (S)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff88cc;"></div>
                    <span>„Éõ„Ç¶Á¥† (B)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #888888;"></div>
                    <span>„Ç±„Ç§Á¥† (Si)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #90ee90;"></div>
                    <span>„Éï„ÉÉÁ¥† (F)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #00ff88;"></div>
                    <span>Â°©Á¥† (Cl)</span>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="viewer-container" id="viewer"></div>

        <div class="info-panel" id="info-panel">
            <h3 id="molecule-name">H‚ÇÇO (Ê∞¥)</h3>
            <p id="molecule-description">Ê∞¥ÂàÜÂ≠ê„ÅØÈÖ∏Á¥†ÂéüÂ≠ê1ÂÄã„Å®Ê∞¥Á¥†ÂéüÂ≠ê2ÂÄã„Åã„ÇâÊßãÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÂàÜÂ≠ê„ÅÆÂΩ¢Áä∂„ÅØÊõ≤„Åå„Å£„ÅüÔºàÂ±àÊõ≤ÔºâÂΩ¢„Çí„Åó„Å¶„Åä„Çä„ÄÅÁµêÂêàËßí„ÅØÁ¥Ñ104.5¬∞„Åß„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëÈÖ∏Á¥†„ÅÆÈõªÊ∞óÈô∞ÊÄßÂ∫¶„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅO-HÁµêÂêà„ÅåÊ•µÊÄß„ÇíÊåÅ„Å°„ÄÅÂàÜÂ≠êÂÖ®‰Ωì„Å®„Åó„Å¶Ê•µÊÄß„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ</p>
        </div>

        <div class="instructions">
            üí° „Éû„Ç¶„Çπ„Åß„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶ÂõûËª¢„ÄÅ„Éû„Ç¶„Çπ„Éõ„Ç§„Éº„É´„Åß„Ç∫„Éº„É†„Åß„Åç„Åæ„Åô
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, controls;
        let currentMolecule = null;
        let isRotating = true;

        // ÂàÜÂ≠ê„Éá„Éº„Çø
        const molecules = {
            H2O: {
                name: "H‚ÇÇO (Ê∞¥)",
                description: "Ê∞¥ÂàÜÂ≠ê„ÅØÈÖ∏Á¥†ÂéüÂ≠ê1ÂÄã„Å®Ê∞¥Á¥†ÂéüÂ≠ê2ÂÄã„Åã„ÇâÊßãÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÂàÜÂ≠ê„ÅÆÂΩ¢Áä∂„ÅØÊõ≤„Åå„Å£„ÅüÔºàÂ±àÊõ≤ÔºâÂΩ¢„Çí„Åó„Å¶„Åä„Çä„ÄÅÁµêÂêàËßí„ÅØÁ¥Ñ104.5¬∞„Åß„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëÈÖ∏Á¥†„ÅÆÈõªÊ∞óÈô∞ÊÄßÂ∫¶„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅO-HÁµêÂêà„ÅåÊ•µÊÄß„ÇíÊåÅ„Å°„ÄÅÂàÜÂ≠êÂÖ®‰Ωì„Å®„Åó„Å¶Ê•µÊÄß„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'O', position: [0, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'H', position: [0.96, 0.25, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.24, 0.97, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 }
                ]
            },
            CO2: {
                name: "CO‚ÇÇ (‰∫åÈÖ∏ÂåñÁÇ≠Á¥†)",
                description: "‰∫åÈÖ∏ÂåñÁÇ≠Á¥†ÂàÜÂ≠ê„ÅØÁÇ≠Á¥†ÂéüÂ≠ê1ÂÄã„Å®ÈÖ∏Á¥†ÂéüÂ≠ê2ÂÄã„Åã„ÇâÊßãÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁõ¥Á∑öÂûã„ÅÆÂàÜÂ≠ê„Åß„ÄÅÁÇ≠Á¥†ÂéüÂ≠ê„Åå‰∏≠ÂøÉ„Å´‰ΩçÁΩÆ„Åó„ÄÅ‰∏°ÂÅ¥„Å´ÈÖ∏Á¥†ÂéüÂ≠ê„ÅåÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇC=O‰∫åÈáçÁµêÂêà„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëC=OÁµêÂêà„ÅØÊ•µÊÄß„Åß„Åô„Åå„ÄÅÁõ¥Á∑öÂûãÊßãÈÄ†„Å´„Çà„ÇäÊ•µÊÄß„ÅåÊâì„Å°Ê∂à„ÅóÂêà„ÅÑ„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'C', position: [0, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'O', position: [1.2, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'O', position: [-1.2, 0, 0], color: 0xff4444, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2, type: 'double' }
                ]
            },
            NH3: {
                name: "NH‚ÇÉ („Ç¢„É≥„É¢„Éã„Ç¢)",
                description: "„Ç¢„É≥„É¢„Éã„Ç¢ÂàÜÂ≠ê„ÅØÁ™íÁ¥†ÂéüÂ≠ê1ÂÄã„Å®Ê∞¥Á¥†ÂéüÂ≠ê3ÂÄã„Åã„ÇâÊßãÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏âËßíÈåê„ÅÆÂΩ¢Áä∂„Çí„Åó„Å¶„Åä„Çä„ÄÅÁ™íÁ¥†ÂéüÂ≠ê„ÅåÈ†ÇÁÇπ„Å´‰ΩçÁΩÆ„Åó„ÄÅ3„Å§„ÅÆÊ∞¥Á¥†ÂéüÂ≠ê„ÅåÂ∫ïÈù¢„ÇíÂΩ¢Êàê„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëÁ™íÁ¥†„ÅÆÈõªÊ∞óÈô∞ÊÄßÂ∫¶„ÅåÈ´ò„Åè„ÄÅÈùûÁµêÂêàÈõªÂ≠êÂØæ„Å´„Çà„ÇäÂàÜÂ≠ê„ÅåÈùûÂØæÁß∞„Å®„Å™„Çã„Åü„ÇÅÊ•µÊÄß„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'N', position: [0, 0, 0], color: 0x4444ff, radius: 0.5 },
                    { element: 'H', position: [0.94, -0.54, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, 0.82], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, -0.82], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            },
            CH4: {
                name: "CH‚ÇÑ („É°„Çø„É≥)",
                description: "„É°„Çø„É≥ÂàÜÂ≠ê„ÅØÁÇ≠Á¥†ÂéüÂ≠ê1ÂÄã„Å®Ê∞¥Á¥†ÂéüÂ≠ê4ÂÄã„Åã„ÇâÊßãÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÊ≠£ÂõõÈù¢‰Ωì„ÅÆÂΩ¢Áä∂„Çí„Åó„Å¶„Åä„Çä„ÄÅÁÇ≠Á¥†ÂéüÂ≠ê„Åå‰∏≠ÂøÉ„Å´‰ΩçÁΩÆ„Åó„ÄÅ4„Å§„ÅÆÊ∞¥Á¥†ÂéüÂ≠ê„ÅåÁ≠â„Åó„ÅÑËßíÂ∫¶„ÅßÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëC-HÁµêÂêà„ÅÆÊ•µÊÄß„ÅØÂ∞è„Åï„Åè„ÄÅÊ≠£ÂõõÈù¢‰ΩìÊßãÈÄ†„Å´„Çà„ÇäÂØæÁß∞ÊÄß„ÅåÈ´ò„ÅÑ„Åü„ÇÅÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'C', position: [0, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [0.63, 0.63, 0.63], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.63, -0.63, 0.63], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.63, 0.63, -0.63], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.63, -0.63, -0.63], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 }
                ]
            },
            HCN: {
                name: "HCN („Ç∑„Ç¢„É≥ÂåñÊ∞¥Á¥†)",
                description: "„Ç∑„Ç¢„É≥ÂåñÊ∞¥Á¥†„ÅØÁõ¥Á∑öÂûãÂàÜÂ≠ê„Åß„ÄÅÁÇ≠Á¥†„Å®Á™íÁ¥†„ÅÆÈñì„Å´‰∏âÈáçÁµêÂêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊ•µ„ÇÅ„Å¶ÊØíÊÄß„ÅåÂº∑„ÅÑÂàÜÂ≠ê„Åß„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëC‚â°NÁµêÂêà„Å®C-HÁµêÂêà„ÅÆÊ•µÊÄß„Å´„Çà„Çä„ÄÅÂàÜÂ≠êÂÖ®‰Ωì„Å®„Åó„Å¶Ê•µÊÄß„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'H', position: [-1.7, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'C', position: [-0.5, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'N', position: [0.7, 0, 0], color: 0x4444ff, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 1, to: 2, type: 'triple' }
                ]
            },
            H2S: {
                name: "H‚ÇÇS (Á°´ÂåñÊ∞¥Á¥†)",
                description: "Á°´ÂåñÊ∞¥Á¥†„ÅØÊ∞¥ÂàÜÂ≠ê„Å®‰ºº„ÅüÂ±àÊõ≤ÊßãÈÄ†„ÇíÊåÅ„Å°„Åæ„Åô„Åå„ÄÅÁµêÂêàËßí„Åå„Çà„ÇäÂ∞è„Åï„Åè„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇËÖê„Å£„ÅüÂçµ„ÅÆ„Å´„Åä„ÅÑ„Åå„Åó„Åæ„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëÁ°´ÈªÑ„ÅÆÈõªÊ∞óÈô∞ÊÄßÂ∫¶„Å´„Çà„Çä S-HÁµêÂêà„ÅåÊ•µÊÄß„ÇíÊåÅ„Å°„ÄÅÂ±àÊõ≤ÊßãÈÄ†„ÅÆ„Åü„ÇÅÂàÜÂ≠êÂÖ®‰Ωì„Å®„Åó„Å¶Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'S', position: [0, 0, 0], color: 0xffcc00, radius: 0.6 },
                    { element: 'H', position: [1.0, 0.2, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.2, 1.0, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 }
                ]
            },
            BH3: {
                name: "BH‚ÇÉ („Éú„É©„É≥)",
                description: "„Éú„É©„É≥„ÅØÂπ≥Èù¢‰∏âËßíÂΩ¢ÊßãÈÄ†„ÇíÊåÅ„Å§ÂàÜÂ≠ê„Åß„Åô„ÄÇ„Éõ„Ç¶Á¥†ÂéüÂ≠ê„ÅØÈõªÂ≠ê‰∏çË∂≥„Åß„ÄÅ‰ªñ„ÅÆÂàÜÂ≠ê„Å®ÁµêÂêà„Åó„ÇÑ„Åô„ÅÑÊÄßË≥™„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëB-HÁµêÂêà„ÅÆÊ•µÊÄß„ÅØÂ∞è„Åï„Åè„ÄÅÂπ≥Èù¢‰∏âËßíÂΩ¢„ÅÆÂØæÁß∞ÊßãÈÄ†„Å´„Çà„ÇäÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'B', position: [0, 0, 0], color: 0xff88cc, radius: 0.5 },
                    { element: 'H', position: [1.0, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.5, 0.87, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.5, -0.87, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            },
            SiH4: {
                name: "SiH‚ÇÑ („Ç∑„É©„É≥)",
                description: "„Ç∑„É©„É≥„ÅØ„É°„Çø„É≥„Å®Âêå„ÅòÊ≠£ÂõõÈù¢‰ΩìÊßãÈÄ†„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ„Ç±„Ç§Á¥†„Åå„É°„Çø„É≥„ÅÆÁÇ≠Á¥†„ÅÆ‰ΩçÁΩÆ„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëSi-HÁµêÂêà„ÅÆÊ•µÊÄß„ÅØÂ∞è„Åï„Åè„ÄÅÊ≠£ÂõõÈù¢‰Ωì„ÅÆÂØæÁß∞ÊßãÈÄ†„Å´„Çà„ÇäÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'Si', position: [0, 0, 0], color: 0x888888, radius: 0.6 },
                    { element: 'H', position: [0.7, 0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, -0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, 0.7, -0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.7, -0.7, -0.7], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 }
                ]
            },
            HF: {
                name: "HF („Éï„ÉÉÂåñÊ∞¥Á¥†)",
                description: "„Éï„ÉÉÂåñÊ∞¥Á¥†„ÅØÊúÄ„ÇÇÂçòÁ¥î„Å™‰∫åÂéüÂ≠êÂàÜÂ≠ê„ÅÆ‰∏Ä„Å§„Åß„Åô„ÄÇ„Éï„ÉÉÁ¥†„ÅØÈõªÊ∞óÈô∞ÊÄßÂ∫¶„ÅåÊúÄ„ÇÇÈ´ò„ÅÑÂÖÉÁ¥†„Åß„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëH-FÁµêÂêà„ÅØÈùûÂ∏∏„Å´Â§ß„Åç„Å™Ê•µÊÄß„ÇíÊåÅ„Å°„ÄÅÂº∑„ÅÑÊ•µÊÄß„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'H', position: [-0.6, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'F', position: [0.6, 0, 0], color: 0x90ee90, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1 }
                ]
            },
            HCl: {
                name: "HCl (Â°©ÂåñÊ∞¥Á¥†)",
                description: "Â°©ÂåñÊ∞¥Á¥†„ÅØÂ°©ÈÖ∏„ÅÆÂéüÊñô„Å®„Å™„ÇãÂàÜÂ≠ê„Åß„Åô„ÄÇÊ∞¥„Å´Ê∫∂„Åë„Çã„Å®Âº∑ÈÖ∏ÊÄß„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëÂ°©Á¥†„ÅÆÈõªÊ∞óÈô∞ÊÄßÂ∫¶„Å´„Çà„Çä H-ClÁµêÂêà„ÅåÂ§ß„Åç„Å™Ê•µÊÄß„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'H', position: [-0.8, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'Cl', position: [0.8, 0, 0], color: 0x00ff88, radius: 0.6 }
                ],
                bonds: [
                    { from: 0, to: 1 }
                ]
            },
            H2: {
                name: "H‚ÇÇ (Ê∞¥Á¥†ÂàÜÂ≠ê)",
                description: "Ê∞¥Á¥†ÂàÜÂ≠ê„ÅØÊúÄ„ÇÇÂçòÁ¥î„Å™ÂàÜÂ≠ê„Åß„ÄÅ2„Å§„ÅÆÊ∞¥Á¥†ÂéüÂ≠ê„ÅåÂÖ±ÊúâÁµêÂêà„ÅßÁµê„Å∞„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëÂêå„ÅòÂéüÂ≠êÂêåÂ£´„ÅÆÁµêÂêà„ÅÆ„Åü„ÇÅ„ÄÅÂÆåÂÖ®„Å´ÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'H', position: [-0.4, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.4, 0, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 }
                ]
            },
            O2: {
                name: "O‚ÇÇ (ÈÖ∏Á¥†ÂàÜÂ≠ê)",
                description: "ÈÖ∏Á¥†ÂàÜÂ≠ê„ÅØ2„Å§„ÅÆÈÖ∏Á¥†ÂéüÂ≠ê„Åå‰∫åÈáçÁµêÂêà„ÅßÁµê„Å∞„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁîüÂëΩ„Å´‰∏çÂèØÊ¨†„Å™ÂàÜÂ≠ê„Åß„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëÂêå„ÅòÂéüÂ≠êÂêåÂ£´„ÅÆÁµêÂêà„ÅÆ„Åü„ÇÅ„ÄÅÂÆåÂÖ®„Å´ÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'O', position: [-0.6, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'O', position: [0.6, 0, 0], color: 0xff4444, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' }
                ]
            },
            N2: {
                name: "N‚ÇÇ (Á™íÁ¥†ÂàÜÂ≠ê)",
                description: "Á™íÁ¥†ÂàÜÂ≠ê„ÅØ2„Å§„ÅÆÁ™íÁ¥†ÂéüÂ≠ê„Åå‰∏âÈáçÁµêÂêà„ÅßÁµê„Å∞„Çå„Å¶„Åä„Çä„ÄÅÈùûÂ∏∏„Å´ÂÆâÂÆö„Å™ÂàÜÂ≠ê„Åß„Åô„ÄÇÂ§ßÊ∞ó„ÅÆÁ¥Ñ78%„ÇíÂç†„ÇÅ„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëÂêå„ÅòÂéüÂ≠êÂêåÂ£´„ÅÆÁµêÂêà„ÅÆ„Åü„ÇÅ„ÄÅÂÆåÂÖ®„Å´ÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'N', position: [-0.55, 0, 0], color: 0x4444ff, radius: 0.5 },
                    { element: 'N', position: [0.55, 0, 0], color: 0x4444ff, radius: 0.5 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'triple' }
                ]
            },
            NH4: {
                name: "NH‚ÇÑ‚Å∫ („Ç¢„É≥„É¢„Éã„Ç¶„É†„Ç§„Ç™„É≥)",
                description: "„Ç¢„É≥„É¢„Éã„Ç¶„É†„Ç§„Ç™„É≥„ÅØÊ≠£ÂõõÈù¢‰ΩìÊßãÈÄ†„ÇíÊåÅ„Å§ÈôΩ„Ç§„Ç™„É≥„Åß„Åô„ÄÇ„Ç¢„É≥„É¢„Éã„Ç¢„ÅåÊ∞¥Á¥†„Ç§„Ç™„É≥„ÇíÂèó„ÅëÂèñ„Å£„Å¶ÂΩ¢Êàê„Åï„Çå„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄß„Ç§„Ç™„É≥„ÄëÊ≠£ÂõõÈù¢‰Ωì„ÅÆÂØæÁß∞ÊßãÈÄ†„Å´„Çà„Çä„ÄÅ„Ç§„Ç™„É≥ÂÜÖ„Åß„ÅÆÈõªËç∑ÂàÜÂ∏É„ÅØÂùáÁ≠â„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'N', position: [0, 0, 0], color: 0x4444ff, radius: 0.5 },
                    { element: 'H', position: [0.7, 0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, -0.7, 0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.7, 0.7, -0.7], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.7, -0.7, -0.7], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 }
                ]
            },
            H3O: {
                name: "H‚ÇÉO‚Å∫ („Ç™„Ç≠„ÇΩ„Éã„Ç¶„É†„Ç§„Ç™„É≥)",
                description: "„Ç™„Ç≠„ÇΩ„Éã„Ç¶„É†„Ç§„Ç™„É≥„ÅØ‰∏âËßíÈåêÊßãÈÄ†„ÇíÊåÅ„Å§ÈôΩ„Ç§„Ç™„É≥„Åß„Åô„ÄÇÊ∞¥ÂàÜÂ≠ê„ÅåÊ∞¥Á¥†„Ç§„Ç™„É≥„ÇíÂèó„ÅëÂèñ„Å£„Å¶ÂΩ¢Êàê„Åï„Çå„Åæ„Åô„ÄÇ„ÄêÊ•µÊÄß„Ç§„Ç™„É≥„Äë‰∏âËßíÈåêÊßãÈÄ†„Å´„Çà„Çä„ÄÅ„Ç§„Ç™„É≥ÂÜÖ„Åß„ÅÆÈõªËç∑ÂàÜÂ∏É„Å´ÂÅè„Çä„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'O', position: [0, 0, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'H', position: [0.94, -0.54, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, 0.82], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-0.47, -0.54, -0.82], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            },
            C2H6: {
                name: "C‚ÇÇH‚ÇÜ („Ç®„Çø„É≥)",
                description: "„Ç®„Çø„É≥„ÅØ2„Å§„ÅÆÁÇ≠Á¥†ÂéüÂ≠ê„ÅåÂçòÁµêÂêà„ÅßÁµê„Å∞„Çå„Åü„Ç¢„É´„Ç´„É≥„Åß„Åô„ÄÇÂêÑÁÇ≠Á¥†„ÅØÊ≠£ÂõõÈù¢‰ΩìÊßãÈÄ†„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëC-CÁµêÂêà„Å®C-HÁµêÂêà„ÅÆÊ•µÊÄß„ÅØÂ∞è„Åï„Åè„ÄÅÂàÜÂ≠êÂÖ®‰Ωì„Å®„Åó„Å¶ÂØæÁß∞ÊÄß„ÅåÈ´ò„ÅÑ„Åü„ÇÅÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'C', position: [-0.8, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'C', position: [0.8, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [-1.3, 0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-1.3, -0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-1.3, 0, -1.0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.3, 0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.3, -0.9, 0.5], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.3, 0, -1.0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 0, to: 4 },
                    { from: 1, to: 5 },
                    { from: 1, to: 6 },
                    { from: 1, to: 7 }
                ]
            },
            C2H4: {
                name: "C‚ÇÇH‚ÇÑ („Ç®„ÉÅ„É¨„É≥)",
                description: "„Ç®„ÉÅ„É¨„É≥„ÅØ2„Å§„ÅÆÁÇ≠Á¥†ÂéüÂ≠ê„Åå‰∫åÈáçÁµêÂêà„ÅßÁµê„Å∞„Çå„Åü„Ç¢„É´„Ç±„É≥„Åß„Åô„ÄÇÂπ≥Èù¢ÂàÜÂ≠ê„Åß„ÄÅÈáçË¶Å„Å™ÂåñÂ≠¶ÂéüÊñô„Åß„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëC=CÁµêÂêà„Å®C-HÁµêÂêà„ÅÆÊ•µÊÄß„ÅØÂ∞è„Åï„Åè„ÄÅÂπ≥Èù¢ÊßãÈÄ†„ÅÆÂØæÁß∞ÊÄß„Å´„Çà„ÇäÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'C', position: [-0.7, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'C', position: [0.7, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [-1.2, 0.9, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [-1.2, -0.9, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.2, 0.9, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [1.2, -0.9, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 },
                    { from: 1, to: 4 },
                    { from: 1, to: 5 }
                ]
            },
            C2H2: {
                name: "C‚ÇÇH‚ÇÇ („Ç¢„Çª„ÉÅ„É¨„É≥)",
                description: "„Ç¢„Çª„ÉÅ„É¨„É≥„ÅØ2„Å§„ÅÆÁÇ≠Á¥†ÂéüÂ≠ê„Åå‰∏âÈáçÁµêÂêà„ÅßÁµê„Å∞„Çå„ÅüÁõ¥Á∑öÂûãÂàÜÂ≠ê„Åß„Åô„ÄÇÊ∫∂Êé•„Å™„Å©„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ„ÄêÁÑ°Ê•µÊÄßÂàÜÂ≠ê„ÄëC‚â°CÁµêÂêà„Å®C-HÁµêÂêà„ÅÆÊ•µÊÄß„ÅØÂ∞è„Åï„Åè„ÄÅÁõ¥Á∑öÊßãÈÄ†„ÅÆÂØæÁß∞ÊÄß„Å´„Çà„ÇäÁÑ°Ê•µÊÄß„Åß„Åô„ÄÇ",
                atoms: [
                    { element: 'H', position: [-1.7, 0, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'C', position: [-0.6, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'C', position: [0.6, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'H', position: [1.7, 0, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1 },
                    { from: 1, to: 2, type: 'triple' },
                    { from: 2, to: 3 }
                ]
            },
            CH2O: {
                name: "CH‚ÇÇO („Éõ„É´„É†„Ç¢„É´„Éá„Éí„Éâ)",
                description: "„Éõ„É´„É†„Ç¢„É´„Éá„Éí„Éâ„ÅØÂπ≥Èù¢‰∏âËßíÂΩ¢ÊßãÈÄ†„ÇíÊåÅ„Å§„Ç¢„É´„Éá„Éí„Éâ„Åß„Åô„ÄÇC=O‰∫åÈáçÁµêÂêà„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ„ÄêÊ•µÊÄßÂàÜÂ≠ê„ÄëC=OÁµêÂêà„ÅÆÂº∑„ÅÑÊ•µÊÄß„Å´„Çà„Çä„ÄÅÂàÜÂ≠êÂÖ®‰Ωì„Å®„Åó„Å¶Â§ß„Åç„Å™Ê•µÊÄß„ÇíÊåÅ„Å°„Åæ„Åô„ÄÇ",
                atoms: [
                    { element: 'C', position: [0, 0, 0], color: 0x444444, radius: 0.5 },
                    { element: 'O', position: [0, 1.2, 0], color: 0xff4444, radius: 0.5 },
                    { element: 'H', position: [-0.9, -0.6, 0], color: 0xffffff, radius: 0.3 },
                    { element: 'H', position: [0.9, -0.6, 0], color: 0xffffff, radius: 0.3 }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2 },
                    { from: 0, to: 3 }
                ]
            }
        };

        // OrbitControls„ÇíÊâãÂãïÂÆüË£ÖÔºà„Ç∫„Éº„É†Ê©üËÉΩ„ÇíÊúâÂäπÂåñÔºâ
        class OrbitControls {
            constructor(camera, domElement) {
                this.camera = camera;
                this.domElement = domElement;
                this.enabled = true;
                this.enableDamping = true;
                this.dampingFactor = 0.25;
                this.enableZoom = true;  // „Ç∫„Éº„É†Ê©üËÉΩ„ÇíÊúâÂäπÂåñ
                this.enableRotate = true;
                this.enablePan = false;

                this.minDistance = 3;
                this.maxDistance = 15;

                this.spherical = { radius: 8, phi: Math.PI / 3, theta: 0 };
                this.sphericalDelta = { radius: 0, phi: 0, theta: 0 };

                this.rotateStart = { x: 0, y: 0 };
                this.rotateEnd = { x: 0, y: 0 };
                this.rotateDelta = { x: 0, y: 0 };

                this.isRotating = false;

                this.setupEventListeners();
                this.update();
            }

            setupEventListeners() {
                this.domElement.addEventListener('mousedown', this.onMouseDown.bind(this));
                this.domElement.addEventListener('wheel', this.onMouseWheel.bind(this), { passive: false });
                this.domElement.addEventListener('contextmenu', (e) => e.preventDefault());
            }

            onMouseDown(event) {
                if (!this.enabled || !this.enableRotate) return;
                
                event.preventDefault();
                this.isRotating = true;

                this.rotateStart.x = event.clientX;
                this.rotateStart.y = event.clientY;

                document.addEventListener('mousemove', this.onMouseMove.bind(this));
                document.addEventListener('mouseup', this.onMouseUp.bind(this));
            }

            onMouseMove(event) {
                if (!this.isRotating) return;

                this.rotateEnd.x = event.clientX;
                this.rotateEnd.y = event.clientY;

                this.rotateDelta.x = this.rotateEnd.x - this.rotateStart.x;
                this.rotateDelta.y = this.rotateEnd.y - this.rotateStart.y;

                this.sphericalDelta.theta -= 2 * Math.PI * this.rotateDelta.x / this.domElement.clientWidth;
                this.sphericalDelta.phi -= 2 * Math.PI * this.rotateDelta.y / this.domElement.clientHeight;

                this.rotateStart.x = this.rotateEnd.x;
                this.rotateStart.y = this.rotateEnd.y;

                this.update();
            }

            onMouseUp() {
                this.isRotating = false;
                document.removeEventListener('mousemove', this.onMouseMove);
                document.removeEventListener('mouseup', this.onMouseUp);
            }

            onMouseWheel(event) {
                if (!this.enabled || !this.enableZoom) return;
                
                event.preventDefault();
                
                // „Ç∫„Éº„É†ÈÄüÂ∫¶„ÇíË™øÊï¥
                const zoomSpeed = 0.1;
                
                if (event.deltaY < 0) {
                    // „Ç∫„Éº„É†„Ç§„É≥
                    this.spherical.radius *= (1 - zoomSpeed);
                } else {
                    // „Ç∫„Éº„É†„Ç¢„Ç¶„Éà
                    this.spherical.radius *= (1 + zoomSpeed);
                }

                // Ë∑ùÈõ¢Âà∂Èôê„ÇíÈÅ©Áî®
                this.spherical.radius = Math.max(this.minDistance, Math.min(this.maxDistance, this.spherical.radius));

                this.update();
            }

            update() {
                this.spherical.radius += this.sphericalDelta.radius;
                this.spherical.theta += this.sphericalDelta.theta;
                this.spherical.phi += this.sphericalDelta.phi;

                this.spherical.radius = Math.max(this.minDistance, Math.min(this.maxDistance, this.spherical.radius));
                this.spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, this.spherical.phi));

                const x = this.spherical.radius * Math.sin(this.spherical.phi) * Math.cos(this.spherical.theta);
                const y = this.spherical.radius * Math.cos(this.spherical.phi);
                const z = this.spherical.radius * Math.sin(this.spherical.phi) * Math.sin(this.spherical.theta);

                this.camera.position.set(x, y, z);
                this.camera.lookAt(0, 0, 0);

                if (this.enableDamping) {
                    this.sphericalDelta.radius *= (1 - this.dampingFactor);
                    this.sphericalDelta.theta *= (1 - this.dampingFactor);
                    this.sphericalDelta.phi *= (1 - this.dampingFactor);
                } else {
                    this.sphericalDelta.radius = 0;
                    this.sphericalDelta.theta = 0;
                    this.sphericalDelta.phi = 0;
                }
            }
        }

        // ÂàùÊúüÂåñ
        function init() {
            const viewer = document.getElementById('viewer');
            
            // „Ç∑„Éº„É≥‰ΩúÊàê
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            // „Ç´„É°„É©‰ΩúÊàê
            camera = new THREE.PerspectiveCamera(75, viewer.clientWidth / viewer.clientHeight, 0.1, 1000);
            camera.position.set(5, 3, 5);

            // „É¨„É≥„ÉÄ„É©„Éº‰ΩúÊàê
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(viewer.clientWidth, viewer.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            viewer.appendChild(renderer.domElement);

            // „É©„Ç§„ÉàË®≠ÂÆö
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // „Ç≥„É≥„Éà„É≠„Éº„É´Ë®≠ÂÆö
            controls = new OrbitControls(camera, renderer.domElement);

            // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
            window.addEventListener('resize', onWindowResize, false);

            // ÂàùÊúüÂàÜÂ≠êË°®Á§∫
            showMolecule('H2O', document.querySelector('.molecule-btn.active'));

            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É´„Éº„ÉóÈñãÂßã
            animate();
        }

        function onWindowResize() {
            const viewer = document.getElementById('viewer');
            camera.aspect = viewer.clientWidth / viewer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(viewer.clientWidth, viewer.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (currentMolecule && isRotating) {
                currentMolecule.rotation.y += 0.01;
            }

            controls.update();
            renderer.render(scene, camera);
        }

        function clearScene() {
            while (scene.children.length > 0) {
                const child = scene.children[0];
                if (child.geometry) child.geometry.dispose();
                if (child.material) {
                    if (Array.isArray(child.material)) {
                        child.material.forEach(material => material.dispose());
                    } else {
                        child.material.dispose();
                    }
                }
                scene.remove(child);
            }

            // „É©„Ç§„Éà„ÇíÂÜçËøΩÂä†
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
        }

        function showMolecule(moleculeKey, buttonElement) {
            // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞ËøΩÂä†
            if (!molecules[moleculeKey]) {
                console.error(`Molecule ${moleculeKey} not found`);
                return;
            }

            const molecule = molecules[moleculeKey];
            
            // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞ËøΩÂä†
            if (!molecule.atoms || !Array.isArray(molecule.atoms)) {
                console.error(`Invalid molecule data for ${moleculeKey}`);
                return;
            }

            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.molecule-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }

            // ÊÉÖÂ†±„Éë„Éç„É´Êõ¥Êñ∞
            document.getElementById('molecule-name').textContent = molecule.name;
            document.getElementById('molecule-description').textContent = molecule.description;

            // „Ç∑„Éº„É≥„ÇØ„É™„Ç¢
            clearScene();

            // ÂàÜÂ≠ê„Ç∞„É´„Éº„Éó‰ΩúÊàê
            const moleculeGroup = new THREE.Group();

            // ÂéüÂ≠ê„ÇíËøΩÂä†
            molecule.atoms.forEach((atom, index) => {
                // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞ËøΩÂä†
                if (!atom.position || !Array.isArray(atom.position) || atom.position.length < 3) {
                    console.error(`Invalid atom position for atom ${index} in molecule ${moleculeKey}`);
                    return;
                }

                const geometry = new THREE.SphereGeometry(atom.radius || 0.5, 32, 32);
                const material = new THREE.MeshLambertMaterial({ 
                    color: atom.color || 0xffffff 
                });
                const atomMesh = new THREE.Mesh(geometry, material);
                atomMesh.position.set(atom.position[0], atom.position[1], atom.position[2]);
                atomMesh.castShadow = true;
                atomMesh.receiveShadow = true;
                moleculeGroup.add(atomMesh);
            });

            // ÁµêÂêà„ÇíËøΩÂä†
            if (molecule.bonds && Array.isArray(molecule.bonds)) {
                molecule.bonds.forEach(bond => {
                    // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞ËøΩÂä†
                    if (bond.from >= molecule.atoms.length || bond.to >= molecule.atoms.length) {
                        console.error(`Invalid bond indices in molecule ${moleculeKey}`);
                        return;
                    }

                    const fromAtom = molecule.atoms[bond.from];
                    const toAtom = molecule.atoms[bond.to];
                    
                    if (!fromAtom.position || !toAtom.position) {
                        console.error(`Invalid atom positions for bond in molecule ${moleculeKey}`);
                        return;
                    }

                    const bondType = bond.type || 'single';
                    const bondCount = bondType === 'single' ? 1 : bondType === 'double' ? 2 : 3;

                    for (let i = 0; i < bondCount; i++) {
                        const geometry = new THREE.CylinderGeometry(0.05, 0.05, 1, 8);
                        const material = new THREE.MeshLambertMaterial({ color: 0xcccccc });
                        const bondMesh = new THREE.Mesh(geometry, material);

                        const start = new THREE.Vector3(fromAtom.position[0], fromAtom.position[1], fromAtom.position[2]);
                        const end = new THREE.Vector3(toAtom.position[0], toAtom.position[1], toAtom.position[2]);
                        const distance = start.distanceTo(end);

                        bondMesh.scale.y = distance;
                        bondMesh.position.copy(start.clone().add(end).multiplyScalar(0.5));

                        // if (bondCount > 1) {
                        //     const offset = (i - (bondCount - 1) / 2) * 0.15;
                        //     const perpendicular = new THREE.Vector3(0, 1, 0);
                        //     const direction = end.clone().sub(start).normalize();
                        //     const cross = perpendicular.cross(direction).normalize();
                        //     bondMesh.position.add(cross.multiplyScalar(offset));
                        // }

                        if (bondCount > 1) {
                            const offset = (i - (bondCount - 1) / 2) * 0.2;
                            const direction = end.clone().sub(start).normalize();
                            
                            // „Çà„ÇäÈÅ©Âàá„Å™ÂûÇÁõ¥„Éô„ÇØ„Éà„É´„ÇíË®àÁÆó
                            let perpendicular;
                            if (Math.abs(direction.y) < 0.9) {
                                perpendicular = new THREE.Vector3(0, 1, 0);
                            } else {
                                perpendicular = new THREE.Vector3(1, 0, 0);
                            }
                            
                            const cross = perpendicular.cross(direction).normalize();
                            bondMesh.position.add(cross.multiplyScalar(offset));
                        }

                        const direction = end.clone().sub(start);
                        bondMesh.lookAt(bondMesh.position.clone().add(direction));
                        bondMesh.rotateX(Math.PI / 2);

                        moleculeGroup.add(bondMesh);
                    }
                });
            }

            scene.add(moleculeGroup);
            currentMolecule = moleculeGroup;
        }

        function toggleRotation() {
            isRotating = !isRotating;
            const btn = document.getElementById('rotationBtn');
            if (isRotating) {
                btn.textContent = '‚è∏Ô∏è ÂõûËª¢ÂÅúÊ≠¢';
                btn.classList.remove('paused');
            } else {
                btn.textContent = '‚ñ∂Ô∏è ÂõûËª¢ÈñãÂßã';
                btn.classList.add('paused');
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        window.addEventListener('load', init);
    </script>
</body>
</html>